{% extends "base.html" %}

{% block title %}Mark Attendance - Labor Management System{% endblock %}
{% block page_title %}Mark Attendance{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Record Worker Attendance</h2>
      <p class="card-subtitle">Mark attendance and wage information for workers</p>
    </div>

    <form method="POST" action="{{ url_for('admin.mark_attendance') }}" id="attendanceForm">
      <div class="grid grid-cols-2">
        <div class="form-group">
          <label for="labor_id" class="form-label">Select Worker *</label>
          <select id="labor_id" name="labor_id" class="form-select" required>
            <option value="">-- Choose a worker --</option>
            {% for labor in labors %}
            <option value="{{ labor.id }}" data-type="{{ labor.worker_type.name if labor.worker_type else '' }}">
              {{ labor.name }} ({{ labor.id_no }})
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="work_date" class="form-label">Work Date *</label>
          <input type="date" id="work_date" name="work_date" class="form-input" value="{{ today_str }}" required>
        </div>

        <div class="form-group">
          <label for="labor_type" class="form-label">Labor Type *</label>
          <select id="labor_type" name="labor_type" class="form-select" required onchange="updateFields()">
            <option value="">-- Select type --</option>
            <option value="Daily">Daily</option>
            <option value="Hourly">Hourly</option>
            <option value="Task-wise">Task-wise</option>
          </select>
        </div>

        <div class="form-group">
          <label for="wage_amount" class="form-label">Wage Amount (â‚¹) *</label>
          <input type="number" id="wage_amount" name="wage_amount" class="form-input" placeholder="500.00" step="0.01"
            min="0" required>
        </div>

        <div class="form-group" id="hoursField" style="display: none;">
          <label for="hours_worked" class="form-label">Hours Worked</label>
          <input type="number" id="hours_worked" name="hours_worked" class="form-input" placeholder="8.5" step="0.5"
            min="0">
          <div class="form-help">Enter hours for hourly workers</div>
        </div>

        <div class="form-group" id="tasksField" style="display: none;">
          <label for="tasks_done" class="form-label">Tasks Completed</label>
          <input type="number" id="tasks_done" name="tasks_done" class="form-input" placeholder="5" min="0">
          <div class="form-help">Enter number of tasks completed</div>
        </div>
      </div>

      <div style="display: flex; gap: var(--space-md); margin-top: var(--space-lg);">
        <button type="submit" class="btn btn-primary btn-lg">
          âœ“ Save Attendance
        </button>
        <a href="{{ url_for('admin.today_attendance') }}" class="btn btn-secondary btn-lg">
          View Today's Attendance
        </a>
        <button type="reset" class="btn btn-ghost btn-lg">
          Clear Form
        </button>
      </div>
    </form>
  </div>

  <!-- Quick Stats -->
  <div class="grid grid-cols-3" style="margin-top: var(--space-xl);">
    <div class="card" style="text-align: center;">
      <div style="font-size: 2rem; margin-bottom: var(--space-sm);">ðŸ‘¥</div>
      <div
        style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--text-primary); margin-bottom: var(--space-xs);">
        {{ labors|length }}
      </div>
      <div style="color: var(--text-muted); font-size: var(--font-size-sm);">Total Workers</div>
    </div>

    <div class="card" style="text-align: center;">
      <div style="font-size: 2rem; margin-bottom: var(--space-sm);">ðŸ“…</div>
      <div
        style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--text-primary); margin-bottom: var(--space-xs);">
        {{ today_str }}
      </div>
      <div style="color: var(--text-muted); font-size: var(--font-size-sm);">Today's Date</div>
    </div>

    <div class="card" style="text-align: center;">
      <div style="font-size: 2rem; margin-bottom: var(--space-sm);">ðŸ“¤</div>
      <div
        style="font-size: var(--font-size-lg); font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-xs);">
        <a href="{{ url_for('attendance_import.import_attendance') }}" style="color: var(--color-primary-light);">
          Bulk Import
        </a>
      </div>
      <div style="color: var(--text-muted); font-size: var(--font-size-sm);">Upload CSV File</div>
    </div>
  </div>
</div>

<script>
  // Update form fields based on labor type selection
  function updateFields() {
    const laborType = document.getElementById('labor_type').value;
    const hoursField = document.getElementById('hoursField');
    const tasksField = document.getElementById('tasksField');
    const hoursInput = document.getElementById('hours_worked');
    const tasksInput = document.getElementById('tasks_done');

    // Hide all optional fields first
    hoursField.style.display = 'none';
    tasksField.style.display = 'none';
    hoursInput.removeAttribute('required');
    tasksInput.removeAttribute('required');

    // Show relevant field based on labor type
    if (laborType === 'Hourly') {
      hoursField.style.display = 'block';
    } else if (laborType === 'Task-wise') {
      tasksField.style.display = 'block';
    }
  }

  // Clear form on reset
  document.getElementById('attendanceForm').addEventListener('reset', function () {
    setTimeout(updateFields, 10);
  });
</script>
{% endblock %}